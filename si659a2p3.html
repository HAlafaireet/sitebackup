<html>

<head>
  <script src="https://aframe.io/releases/0.8.0/aframe.min.js"></script>
  <script src="https://rawgit.com/Utopiah/googlepoly-load-component/master/googlepoly-load-component.js"></script>
  <!--environment script from https://www.npmjs.com/package/aframe-environment-component-->
<script src="https://rawgit.com/feiss/aframe-environment-component/master/dist/aframe-environment-component.min.js"></script>

<script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v5.0.0/dist/aframe-extras.min.js"></script>

<script src="https://cdn.rawgit.com/donmccurdy/aframe-physics-system/v3.3.0/dist/aframe-physics-system.min.js"></script>

<script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.min.js"></script>

<script src="//unpkg.com/aframe-event-set-component@4.0.1/dist/aframe-event-set-component.min.js"></script>

<script>
AFRAME.registerComponent('fuse_jack-listener', {
    init: function () {
        this.el.addEventListener('click', function (evt) {
            this.emit('fuse_jack');
            console.log('I was clicked at: ', evt.detail.intersection.point);
    });
        
    }
  });
</script>

<script>
    AFRAME.registerComponent('fuse_gs-listener', {
        init: function () {
            this.el.addEventListener('click', function (evt) {
                this.emit('fuse_gs');
                console.log('Gravestone was clicked at: ', evt.detail.intersection.point);
        });
            
        }
      });
    </script>

<script>

AFRAME.registerComponent('fuse_wp-listener', {
    init: function () {
        let camera_rig = document.querySelector("#camera_rig");
        //let waypoint = document.querySelector("#waypoint");
        //attach gaze fuse handle to waypoint
        this.el.addEventListener("click", function(e) {
        //move the camera rig to the new location
        console.log('Teleporter was clicked at: ');
        camera_rig.setAttribute("position", this.getAttribute("position"));
        }); 
    }
  });

  AFRAME.registerComponent('ghost-listener', {
    init: function () {
        
        this.el.addEventListener("click", function(e) {
        //move the camera rig to the new location
        console.log('activating walk animation! ');
        this.setAttribute("animation-mixer", "clip: marcher");
        }); 
    }
  });
</script>


<script>
    // turn controller's physics presence on only while button held down
    AFRAME.registerComponent("phase-shift", {
      init: function() {
        console.warn("installing phase shift");
        var el = this.el;
        el.addEventListener("gripdown", function() {
          el.setAttribute("collision-filter", {
            collisionForces: true
          });
          console.log("Physics hand active!");
        });
        el.addEventListener("gripup", function() {
          el.setAttribute("collision-filter", {
            collisionForces: false
          });
          console.log("Physics hand inactive!");
        });
      }
    });
  </script>


</head>

<body>
    <a-scene physics="friction: 0.1; restitution: 0.8">
    <!---<a-scene sound="src: #ghost_party; loop: true; on: click; rolloffFactor: 0; volume:0.3">-->
        <a-asset>
            <!--haunted house model by Maker Moose at https://sketchfab.com/models/8278ebd4786c462cb2621385a91ee365-->    
            <a-asset-item id="hhouse" src="Assets/SI659_Assets/haunted_house/scene.gltf"></a-asset-item>
            <a-asset-item id="ghost" src="Assets/SI659_Assets/ghost/scene.gltf"></a-asset-item>

            <!-- "Ghost Party" audio taken from https://freemusicarchive.org/music/download/ee603225eae952d6492414b12d5ffc02ef62c8ce--> 
    
            <audio id="ghost_party" src="Assets/SI659_Assets/Loyalty_Freak_Music_-_12_-_Halloween_Ghost_Party.mp3" crossorigin="anonymous"></audio>

            <!-- Zombie Snarl audio by gneube at https://freesound.org/people/gneube/sounds/315844/-->
            <audio id="zombie_snarl" src="Assets/SI659_Assets/315844__gneube__zombie-snarl.wav" crossorigin="anonymous"></audio>

            <!--Touch mixin taken from M. Nebelings example at https://codepen.io/mnebeling/pen/qLQjLJ-->
            <a-mixin id="touch" physics-collider phase-shift collision-filter="collisionForces: false" static-body="shape: sphere; sphereRadius: 0.02" super-hands="colliderEvent: collisions;     colliderEventProperty: els; colliderEndEvent: collisions; colliderEndEventProperty: clearedEls;">
              </a-mixin>

              <a-mixin id="touchme"  hoverable grabbable stretchable draggable
              event-set__hoveron="_event: hover-start; material.opacity: 0.7; transparent: true"
              event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false"></a-mixin>


        </a-asset>

        <a-entity gltf-model=#hhouse static-body position="0 0 -20" scale=".5 .5 .5" shadow="receive: true; cast:false"></a-entity>
        <a-entity environment= "preset: starry"></a-entity>


       <!-- <a-box id = "jack2" dynamic-body mixin="touchme" mass="1" position="0 1 -1.5" scale="2 2 1" shadow="cast: true">
            <a-animation attribute="rotation"
               dur="1000"
               to="0 360 0"
               easing="linear"
               begin="fuse_jack">
            </a-animation>
        </a-box>-->



        <!--pumpkin head model by Rafi Ankur at https://poly.google.com/view/cggu6F8hvCm-->
        <a-entity id = "jack" fuse_jack-listener dynamic-body mixin="touchme" mass="1" position="0 1 -1" scale=".005 .005 .005" gpoly="polyid:cggu6F8hvCm; API_KEY:AIzaSyAvchkb7QS5ZatB2NttfnCKXtqvyB-NQOo;" shadow="cast: true">
      </a-entity>  

        <!--gravestone model by Ian MacGillivray at https://poly.google.com/view/fCeGs6ZRSVp-->
        <a-entity id = "gravestone" fuse_gs-listener position="15.62119 -.1 -5.1049" scale="1 1 1" rotation="0 -120 0" gpoly="polyid:fCeGs6ZRSVp; API_KEY:AIzaSyAvchkb7QS5ZatB2NttfnCKXtqvyB-NQOo;" shadow="cast: true" sound="src: #zombie_snarl; on: click; volume: 3; poolSize: 3">
            <a-animation attribute="position"
            dur="1000"
            to="15.62119 .7 -5.1049"
            easing="linear"
            direction="alternate"
            begin="fuse_gs"></a-animation>
            
        </a-entity>

        <!--Ghost Model by OncleBen @ https://sketchfab.com/models/6fb3dd0ce5bf436db3c40796bd360820-->
        <a-entity id="ghostie" ghost-listener gltf-model=#ghost position="-15.62119 -0.27 -7.1049" scale = ".02 .02 .02" shadow></a-entity>

        <!-- Lantern model by Hunter Paramore at https://poly.google.com/view/6lpNbvA7Mj8-->
        <a-entity id="lantern_left" position="-3.8008 6.3368 -13.19289" gpoly="polyid:6lpNbvA7Mj8;API_KEY:AIzaSyAvchkb7QS5ZatB2NttfnCKXtqvyB-NQOo" shadow="" obj-model="obj:https://poly.googleapis.com/downloads/6lpNbvA7Mj8/fxYBG8niUK9/model.obj;mtl:https://poly.googleapis.com/downloads/6lpNbvA7Mj8/fxYBG8niUK9/materials.mtl"></a-entity>
        <a-entity id="lantern_right" position="6.77346 6.3368 -13.19289" gpoly="polyid:6lpNbvA7Mj8;API_KEY:AIzaSyAvchkb7QS5ZatB2NttfnCKXtqvyB-NQOo" shadow="" obj-model="obj:https://poly.googleapis.com/downloads/6lpNbvA7Mj8/fxYBG8niUK9/model.obj;mtl:https://poly.googleapis.com/downloads/6lpNbvA7Mj8/fxYBG8niUK9/materials.mtl"></a-entity>
        
          <!-- ground collider keeps objets from falling -->
      <a-box static-body width=100 height=0.001 depth=100 visible="false"></a-box>

        <a-light type="ambient" color="#222" intensity="2.0"></a-light>
        <a-light id="light_left" color="yellow" position="-3.55553 6.96878 -11.48506" intensity="1.5" light="type:point; castShadow:true shadowCameraVisible: true"></a-light>
        <a-light id="light_right" color="yellow" position="6.21379 5.95892 -11.48506" intensity="1.5" light="type:point;castShadow:true"></a-light>

        <a-entity look-controls id="camera_rig" position="0 1 0">
            <a-camera id="camera">
            <a-entity cursor="fuse: true; fuseTimeout: 500"
                      position="0 0 -1"
                      geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: orange; shader: flat">
            </a-entity>
        </a-camera>
          </a-entity>


          <a-box id="waypoint" fuse_wp-listener position="17.62119 2.12396 -3.1049" rotation="-180 90 0" width="2" height="2" color="purple" material="" geometry="">
            <a-animation attribute="position"
            dur="1000"
            to="17.62119 2.4 -3.1049"
            easing="linear"
            direction="alternate"
            repeat="indefinite">
         </a-animation>
         

          </a-box>

         <!-- <a-box id="waypoint_start" fuse_wp-listener position="0 1 0" rotation="-180 90 0" width="1" height="1" color="green" material="opacity:0.75" geometry="">
            <a-animation attribute="position"
            dur="1000"
            to="0 1.4 0"
            easing="linear"
            direction="alternate"
            repeat="indefinite">
         </a-animation>
          </a-box>-->

          <a-box id="waypoint_2" fuse_wp-listener position="-17.62119 2.12396 -3.1049" rotation="-180 90 0" width="2" height="2" color="red" material="" geometry="" shadow="cast:true">
            <a-animation attribute="position"
            dur="1000"
            to="-17.62119 2.4 -3.10490"
            easing="linear"
            direction="alternate"
            repeat="indefinite">
         </a-animation>
          </a-box>

          <a-plane position="0 -2.4 0" rotation="-90 -90 0" scale ="500 500 500" material="opacity: 0.0; transparent: true" static-body ></a-plane>

            <!-- hand controls -->
    <a-entity id="left-hand" mixin="touch" hand-controls="left" vive-controls="hand: left" oculus-touch-controls="hand: left" windows-motion-controls="hand: left"></a-entity>

    <a-entity id="right-hand" mixin="touch" hand-controls="right" daydream-controls vive-controls="hand: right" oculus-touch-controls="hand: right" windows-motion-controls="hand: right"></a-entity>

    <a-entity id="handy1" sphere-collider="objects: a-box" super-hands hand-controls="left"></a-entity>
    <a-entity id="handy2" sphere-collider="objects: a-box" super-hands hand-controls="right"></a-entity>

    
    </a-scene>
</body>


</html>
